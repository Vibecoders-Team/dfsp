#!/usr/bin/env bash
# Args: $1 = path to commit message file
set -euo pipefail

BRANCH="$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "")"

is_dev_branch() {
  case "$BRANCH" in
    dev|*/dev) return 0 ;;
    *)         return 1 ;;
  esac
}

python3 ".githooks/commit-msg.py" "$1" "$BRANCH" || STATUS=$? || true
STATUS="${STATUS:-0}"

if is_dev_branch && [ "$STATUS" -ne 0 ]; then
  echo "[warn] Conventional Commits violation on '$BRANCH' â†’ allowed (soft)."
  exit 0
fi

exit "${STATUS}"
