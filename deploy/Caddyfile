# Caddy HTTPS reverse proxy for dfsp.app
# Assumes DNS A record for dfsp.app points to this server.
# Provides automatic Let's Encrypt certificates.

{
  email you@example.com
  # optional: acme_ca https://acme.zerossl.com/v2/DV90
}

dfsp.app {
  encode gzip

  # Serve frontend static files (mounted volume)
  root * /usr/share/caddy/html
  file_server

  # API proxy (/api/*)
  handle_path /api/* {
    reverse_proxy api:8000
  }

  # Security headers (some duplicated from backend; backend still sets API ones)
  header {
    Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    X-Frame-Options "DENY"
    X-Content-Type-Options "nosniff"
    Referrer-Policy "no-referrer"
    Content-Security-Policy "default-src 'self'; object-src 'none'; frame-ancestors 'none'; base-uri 'self'"
  }
}

# Optional redirect from www -> apex
www.dfsp.app {
  redir https://dfsp.app{uri}
}

